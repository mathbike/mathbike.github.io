---
title:  Flask
categories: [Python]
tags: [python]
mermaid: true
---

This article sources:
<a href="https://flask.palletsprojects.com/en/2.2.x/" target="_blank">https://flask.palletsprojects.com/en/2.2.x/</a>

flask_basic repo:
<a href="https://github.com/mathbike/flask_basic" target="_blank">https://github.com/mathbike/flask_basic</a>

---

## Definitions

A Flask application is an instance of the Flask class.

**Application Factory:**

The application factory function is the `create_app()` function in the `$NAME/__init__.py` file.  Any configuration, registration, and other setup the application needs will happen inside this function, then the application will be returned.

**Views:**

A view function is the code you write to respond to requests to your application.  The incoming request URL is matched to the view that should handle it.  The view returns data that Flask turns into an outgoing response.  Flask can also go the other direction and generate a URL to a view based on its name and arguments.

A view function can return HTML using the `render_template('index.html')` function.

**Blueprints:**

A Blueprint is a way to organize a group of related views and other code. Rather than registering views and other code directly with an application, they are registered with a blueprint. Then the blueprint is registered with the application when it is available in the factory function.

**Templates:**

Templates are files that contain static data as well as placeholders for dynamic data. A template is rendered with specific data to produce a final document. Flask uses the Jinja template library to render templates.  Templates are used to render HTML which will display in the userâ€™s browser.

{% raw %}
Jinja looks and behaves mostly like Python. Special delimiters are used to distinguish Jinja syntax from the static data in the template. Anything between `{{` and `}}` is an expression that will be output to the final document. Anything between `{%` and `%}` denotes a control flow statement like `if` and `for`. Unlike Python, blocks are denoted by start and end tags rather than indentation since static text within a block could change indentation.
{% endraw %}

---

## Setup

Choose a name for your Flask app, run this script in the terminal, then enter the name of your Flask app in the prompt. 

```sh
echo "enter the name of your Flask app:" && read NAME
git clone https://github.com/mathbike/flask_basic ~/$NAME
cd $NAME
rm -rf .git
python3 -m venv .venv
source .venv/bin/activate
pip install Flask Flask-WTF Flask-SQLAlchemy
pip freeze > requirements.txt
deactivate
COMMANDS_TXT="z.1_commands.txt"
echo -e "########## COMMANDS ##########\n" > $COMMANDS_TXT
echo "flask --app $NAME run" >> $COMMANDS_TXT
echo "flask --app $NAME --debug run" >> $COMMANDS_TXT
echo "flask --app $NAME init-db" >> $COMMANDS_TXT
echo "" >> $COMMANDS_TXT
echo "pip freeze > requirements.txt" >> $COMMANDS_TXT
cd
```

---

## Define the database

`$NAME/schema.md`
```mermaid
%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#8ab4f8', 'lineColor': '#4a86e8', 'textColor': 'black'}}}%%
erDiagram
    user ||--o{ something : creates
    user {
        integer user_id PK
        user_id integer PK
        text username
        text email
        text password
    }
    something {
        integer user_id FK
        integer something_id PK
        date time
        string variable_string
        integer variable_integer
    }
```

---

## Create the schema

`$NAME/schema.sql`
```sql

DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS SOMETHING;

CREATE TABLE USER (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username TEXT UNIQUE NOT NULL,
    email TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL
);

CREATE TABLE SOMETHING (
    FOREIGN KEY (user_id) REFERENCES user (id),
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    entry_price FLOAT NOT NULL,
    size FLOAT NOT NULL
);
```

---

## Initialize the database

```terminal
flask --app $NAME init-db
```
This creates `instance/$NAME.sqlite`
